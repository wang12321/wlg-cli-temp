const promisify=require("util")["promisify"],download=promisify(require("download-git-repo")),inquirer=require("inquirer"),fs=require("fs"),handlebars=require("handlebars"),resolve=require("path")["resolve"],run=require("runjs")["run"],chalk=require("chalk"),log=e=>console.log(chalk.green(e)),errorLog=e=>console.log(chalk.red(e)),addBreadcrumb=require("./addBreadcrumb.js"),addTagsView=require("./addTagsView.js"),addGameShow=require("./addGameShow.js"),addUnifiedLogin=require("./addUnifiedLogin.js"),addSwitchEnvironment=require("./addSwitchEnvironment.js"),addHeaderSearch=require("./addHeaderSearch.js"),addNew=require("./addNew.js"),addNavBarMenu=require("./addNavBarMenu.js");module.exports.clonePC=async(e,n)=>{log("__dirname : "+__dirname),log("resolve   : "+resolve("./"));const a=require("ora")("下载..."+e);a.start(),await download(e,n,{clone:!0},e=>{e?(errorLog(`
            error: `+e),a.fail("下载失败")):(log(`
            success`),a.succeed("下载成功"),inquirer.prompt([{type:"input",name:"name",message:"请输入项目名称"},{type:"input",name:"description",message:"请输入项目简介"},{type:"input",name:"author",message:"请输入作者名称"}]).then(async e=>{console.log(e);var a=n+"/package.json",r=fs.readFileSync(a,"utf8"),r=handlebars.compile(r)(e);fs.writeFileSync(a,r),inquirer.prompt([{type:"checkbox",name:"funcName",message:"请选择配置功能",checked:!0,choices:[{value:"Breadcrumb",name:"Breadcrumb (添加面包屑)"},{value:"SwitchEnvironment",name:"SwitchEnvironment (添加切换环境按钮)"},{value:"HeaderSearch",name:"HeaderSearch (添加菜单搜索)"},{value:"New",name:"New（添加菜单new！标志)"},{value:"UnifiedLogin",name:"UnifiedLogin (接入统一登入)"},{value:"GameShow",name:"GameShow (添加展示游戏平台)"}],default:["New","SwitchEnvironment"]}]).then(async e=>{log("rows",e),run("npm install",{cwd:resolve("./")+"/"+n});var a=e.funcName||[];for(let e=0;e<a.length;e++)switch(a[e]){case"TagsView":await addTagsView(n);break;case"Breadcrumb":await addBreadcrumb(n);break;case"GameShow":await addGameShow(n);break;case"UnifiedLogin":await addUnifiedLogin(n);break;case"SwitchEnvironment":await addSwitchEnvironment(n);break;case"HeaderSearch":await addHeaderSearch(n);break;case"New":await addNew(n);break;case"NavBarMenu":await addNavBarMenu(n);break;default:errorLog("请输入选择的功能名")}run("npm run lint:fix",{cwd:resolve("./")+"/"+n}),run("npm run dev:mock",{cwd:resolve("./")+"/"+n})}).catch(e=>{errorLog(e)})}))})};