const{resolve:resolve}=require("path"),{fscreateReadStream:fscreateReadStream,fscreateWriteStream:fscreateWriteStream,isFileExisted:isFileExisted,newStr:newStr,unlink:unlink}=require("./common.js"),{run:run}=require("runjs"),chalk=require("chalk"),log=e=>console.log(chalk.green(e)),errorLog=e=>console.log(chalk.red(e));module.exports=async()=>{log("resolve   : "+resolve("./"));try{var e=await async function(){var r=`${resolve("./")}/src/layout/index.vue`;if(await isFileExisted(r)){let e=await fscreateReadStream(r);if(-1===e.indexOf("<tags-view />"))return errorLog("不存在<tags-view />配置导航标签"),Promise.reject(new Error("Error"));var o="<tags-view />";if(-1<e.indexOf(o)){e=e.replace(o,""),e=e.replace("import TagsView from './components/TagsView'",""),e=e.replace(`,
    TagsView`,"");r=e.match(/(.fixed-header\s*\+\s*.app-main\s*\{([\s\S]*?))\}/g),r=r&&r[r.length-1];return e=e.replace(r,`.fixed-header+.app-main {
  padding-top: 50px;
}`),Promise.resolve(e)}return errorLog(`src/layout/index.vue文件修改失败!
                请检查代码:
                1、是否有:${o}
                `),Promise.reject(new Error("Error"))}return errorLog("找不到src/layout/index.vue目标文件，请查看命令是否使用正确"),Promise.reject(new Error("Error"))}();await async function(){var e=`${resolve("./")}/src/layout/components/TagsView`;if(!await isFileExisted(e))return errorLog("不存在目标文件src/layout/components/TagsView"),Promise.reject(new Error("Error"));try{return await unlink(`${resolve("./")}/src/layout/components/TagsView`),log("src/store/modules/tagsView文件删除成功"),Promise.resolve(!0)}catch(e){return Promise.reject(new Error("Error"))}}(),await async function(){var e=`${resolve("./")}/src/store/modules/tagsView.js`;if(!await isFileExisted(e))return errorLog("不存在目标文件src/store/modules/tagsView.js"),Promise.reject(new Error("Error"));try{return await unlink(`${resolve("./")}/src/store/modules/tagsView.js`),log("src/store/modules/tagsView.js文件删除成功"),Promise.resolve(!0)}catch(e){return Promise.reject(new Error("Error"))}}(),await fscreateWriteStream(`${resolve("./")}/src/layout`,"index.vue",e),log("src/layout/index.vue文件修改成功"),run("npm run lint:fix",{cwd:`${resolve("./")}`})}catch(e){errorLog("目标代码出错，请按上述报错信息检查代码")}};